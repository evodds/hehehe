<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>EVOdds – Leaderboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: ui-sans-serif, system-ui, Arial, sans-serif; margin: 24px; }
    table { border-collapse: collapse; width:100%; margin-top:12px; }
    th, td { border-bottom:1px solid #eee; padding:8px; text-align:left; vertical-align: top; }
    .muted { color:#6b7280; }
  </style>
</head>
<body>
  <h1>Rolling EV Leaderboard <span class="muted">(from saved signals)</span></h1>
  <div>
    <label>Group by
      <select id="group_by">
        <option value="player_market_book">Player + Market + Book</option>
        <option value="market_book">Market + Book</option>
        <option value="book">Book only</option>
      </select>
    </label>
    <label>Min samples <input id="min_samples" type="number" value="5" min="1" style="width:80px"></label>
    <label>Limit <input id="limit" type="number" value="100" min="1" max="1000" style="width:80px"></label>
    <button id="go">Refresh</button>
    <a href="/" style="margin-left:20px">← Back to main</a>
  </div>
  <table id="tbl">
    <thead>
      <tr><th>Key</th><th>n</th><th>avg EV%</th><th>p90 EV%</th><th>max EV%</th><th>last seen</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <script>
    async function load() {
      await refresh();
    }
    async function refresh() {
      const g = document.getElementById('group_by').value;
      const m = document.getElementById('min_samples').value || '5';
      const l = document.getElementById('limit').value || '100';
      const j = await fetch(`/api/leaderboard?group_by=${encodeURIComponent(g)}&min_samples=${m}&limit=${l}`).then(r=>r.json());
      const tb = document.querySelector('#tbl tbody');
      tb.innerHTML = '';
      (j.items || []).forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.key}</td><td>${r.n}</td><td>${r.avg_ev_pct.toFixed(2)}</td><td>${r.p90_ev_pct.toFixed(2)}</td><td>${r.max_ev_pct.toFixed(2)}</td><td>${r.last_seen}</td>`;
        tb.appendChild(tr);
      });
    }
    document.getElementById('go').addEventListener('click', refresh);
    load();
  </script>
</body>
</html>
